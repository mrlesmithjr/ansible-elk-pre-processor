# {{ ansible_managed }}
#
filter {
  if "syslog" in [tags] {
    grok {
      match => [
        "message", "<%{POSINT}>%{TIMESTAMP_ISO8601} %{SYSLOGHOST:syslog_host_id} %{DATA:pre_syslog_program}(?:\[%{POSINT:pre_syslog_pid}\])?: %{GREEDYDATA}",
        "message", "<%{POSINT}>%{SYSLOGTIMESTAMP} %{SYSLOGHOST:syslog_host_id} %{DATA:pre_syslog_program}(?:\[%{POSINT:pre_syslog_pid}\])?: %{GREEDYDATA}",
        "message", "<%{POSINT}>%{SYSLOGTIMESTAMP} %{DATA:pre_syslog_program}(?:\[%{POSINT:pre_syslog_pid}\])?: %{GREEDYDATA}"
      ]
    }
    mutate {
      add_field => [ "pre-msg", "%{message}" ]
    }
{% if logstash_custom_tagging is defined %}
{%   for tag in logstash_custom_tagging %}
{%     for name in tag.naming %}
    if "{{ name }}" in [syslog_host_id] {
      add_tag => [ "{{ tag.name }}"]
    }
{%     endfor %}
{%   endfor %}
{% endif %}
  }
}
