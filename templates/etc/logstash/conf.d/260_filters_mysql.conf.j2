# {{ ansible_managed }}
#
# Setting up MySQL parsing
filter {
  if "syslog" in [tags] and "pre-processed" not in [tags] {
    if [pre_syslog_program] == "mysqld" {
      multiline {
        pattern => "memb {"
        what => "next"
      }
      multiline {
        pattern => "} joined {"
        what => "previous"
      }
      multiline {
        pattern => "} left {"
        what => "previous"
      }
      mulitline {
        pattern => "} partitioned {"
        what => "previous"
      }
      multiline {
        pattern => "}\)"
        what => "previous"
      }
      if "multiline" in [tags] and "WSREP" in [message] {
        mutate {
          add_tag => [ "MySQL", "MySQL-Replication", "pre-processed" ]
        }
      }
      mutate {
        rename => [ "pre_syslog_program", "syslog_program" ]
        rename => [ "pre_syslog_pid", "syslog_pid" ]
      }
    }
  }
}
